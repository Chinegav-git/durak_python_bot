# Історія змін

## [1.2.5] - 2024-05-24

### Виправлено
- **Усунуто "зависання" гри після першого раунду.** Після передачі ходу бот тепер надсилає повідомлення з кнопкою "Атакувати", спонукаючи наступного гравця до дії.
- **Виправлено критичну помилку `TransactionError`**, яка виникала під час атаки або захисту. Усі операції з базою даних тепер коректно виконуються в межах `db_session`, що запобігає падінню бота.
- **Виправлено помилку `TypeError` при створенні нової гри (`/new`).** Код було виправлено для отримання даних про користувача та чат з об'єкта `message`, а не через `get_current()`, що забезпечило стабільну роботу команди.
- **Виправлено збереження гри.** Нова гра тепер коректно зберігається, що дозволяє іншим командам, як-от `/gamemode`, взаємодіяти з нею.

## [1.2.4] - 2024-05-24

### Виправлено
- Усунуто критичну помилку `KeyError: 'game'` в обробнику команди `/gamemode`. Помилка виникала, коли команда викликалася до створення гри, що призводило до мовчазного збою. Прямий доступ до `dp.bot['game']` було замінено на безпечний метод `dp.bot.get('game')`, завдяки чому бот тепер коректно повідомляє, що гра ще не створена.

## [1.2.3] - 2024-05-24

### Виправлено
- Усунуто критичну помилку `ModuleNotFoundError` в модулі `game_mode.py`. Помилка виникала через спробу імпортувати неіснуючі функції з `durak.db.db_api`. Код було виправлено для безпосереднього використання моделі `ChatSetting` та сесії Pony ORM, що відновило функціональність команди `/gamemode`.

## [1.2.2] - 2024-05-23

### Виправлено
- Усунуто критичну помилку `ImportError` під час запуску бота, викликану конфліктом версій бібліотеки `aiogram` (v2 та v3).
- Повністю адаптовано код для коректної роботи з `aiogram` v2, що забезпечило стабільність роботи всього додатку.

## [1.2.1] - 2024-05-23

### Виправлено
- Усунуто помилку `OperationalError: no such column: ChatSetting.display_mode`, що виникала через некоректне оновлення схеми бази даних. Шлях до БД тепер вказано явно, щоб уникнути конфліктів.
- Виправлено помилку `NameError: Invalid filter name(s): 'is_admin'`, змінивши порядок ініціалізації фільтрів у `bot.py` для відповідності вимогам `aiogram`.

## [1.2.0] - 2024-05-22

### Додано
- **Розширено систему режимів відображення:** Додано третій режим `sticker_and_button`, який виводить лише стікер атакуючої карти та кнопку для відповіді, без супровідного тексту. Це робить інтерфейс мінімалістичним, хоча і менш інформативним.

### Змінено
- **Оновлено команду `/gamemode`:** Тепер команда підтримує три режими: `text`, `text_and_sticker`, та `sticker_and_button`.

## [1.1.0] - 2024-05-22

### Додано
- **Система режимів відображення гри:** Додано команду `/gamemode` для перемикання між текстовим режимом (`text`) та режимом зі стікерами (`text_and_sticker`).
- **Візуалізація атаки стікером:** В режимі `text_and_sticker` бот надсилає стікер карти, яка використовується для атаки, і видаляє його після розіграшу.
- **Автоматичний пас для гри на двох:** Прискорює гру, автоматично завершуючи хід, якщо атакуючий не може підкинути карти.
- **Автовидалення службових повідомлень:** Повідомлення про атаку та пас тепер автоматично видаляються, щоб не засмічувати чат.
- **Гнучка система тем для карт:** Дозволяє легко змінювати зовнішній вигляд карт.
- **Інструмент для отримання `file_id` стікерів** для адміністраторів.
- Додано команду `/test_win` для адміністраторів для відладки ігор.

### Змінено
- **Покращено відображення карт:** Текстове представлення карт стало більш читабельним (напр., `10 ♥`).
- **Повна локалізація на українську мову.**
- Покращено та уніфіковано ігрові повідомлення.

### Виправлено
- Виправлено логіку пасу та переходу ходу для уникнення передчасного завершення.
- Відновлено роботу інлайн-кнопок "Приєднатися" та "Почати гру".
- Усунуто низку критичних помилок, що призводили до збоїв у роботі бота, зокрема при використанні адміністративних команд та в певних ігрових сценаріях.

### Документація
- Оновлено `instructions.md` та `CHANGELOG.md` для відображення всіх останніх змін.
