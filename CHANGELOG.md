# Історія змін

## [1.2.7] - 2024-05-25

### Refactored
- **Розділено відповідальність стану гри та налаштувань:**
    - В `ChatSetting` додано поле `is_game_active` (bool) для відстеження активної ігрової сесії, що усуває конфлікт з полем `display_mode`.
    - `GameManager` тепер керує виключно `is_game_active` для початку та завершення гри, не торкаючись `display_mode`.
    - При запуску `GameManager.new_game` перевіряє наявність гри в пам'яті. Якщо гра існує лише в БД, але не в пам'яті (після перезапуску), поле `is_game_active` примусово встановлюється в `False`, що гарантує стабільну роботу `/new`.

### Fixed
- **Виправлено логіку `/gamemode`:**
    - Обробник тепер використовує `CommandObject` для отримання аргументів.
    - Виклик `/gamemode` без аргументів повертає поточне значення `display_mode` з БД.
    - Виклик `/gamemode [mode]` оновлює `display_mode` в БД, зберігаючи налаштування між іграми.

### Added
- **Створено `.gitignore`:** Додано стандартний `.gitignore` для Python-проектів для виключення `__pycache__`, `venv`, `.pyc` та інших нерелевантних файлів з-під версійного контролю.

## [1.2.6] - 2024-05-24

### Fixed
- Вирішено проблему з виконанням застарілого коду через кешування `.pyc` файлів. 
- `AttributeError: 'Card' object has no attribute 'rank'` остаточно виправлено заміною `.rank` на `.value` при перевірці можливості підкинути карту.
- `TypeError` в `/new` виправлено шляхом переходу з `get_current()` на отримання `chat` та `user` з об'єкта `message`.

## [1.2.5] - 2024-05-24

### Fixed
- `AttributeError: 'Card' object has no attribute 'rank'` в `attacker_can_continue` виправлено заміною `.rank` на `.value`.
- Видалено дублюючий колбек `send_turn_notification` для усунення зайвого сповіщення.
- `TransactionError` під час ігрових дій виправлено обгортанням логіки в `db_session`.

## [1.2.4] - 2024-05-24

### Fixed
- `KeyError: 'game'` в `/gamemode` виправлено заміною прямого доступу `dp.bot['game']` на безпечний `dp.bot.get('game')`.

## [1.2.3] - 2024-05-24

### Fixed
- `ModuleNotFoundError` в `game_mode.py` виправлено шляхом прямого використання моделі `ChatSetting` замість неіснуючого `db_api`.

## [1.2.2] - 2024-05-23

### Fixed
- `ImportError` через конфлікт версій `aiogram` (v2/v3) виправлено повною адаптацією коду під v2.

## [1.2.1] - 2024-05-23

### Fixed
- `OperationalError: no such column: ChatSetting.display_mode` виправлено явним зазначенням шляху до БД.
- `NameError: Invalid filter name(s): 'is_admin'` виправлено зміною порядку ініціалізації фільтрів.

## [1.2.0] - 2024-05-22

### Added
- Додано третій режим відображення `sticker_and_button`.

### Changed
- Команда `/gamemode` тепер підтримує три режими.

## [1.1.0] - 2024-05-22

### Added
- Команда `/gamemode` для перемикання режимів `text` / `text_and_sticker`.
- Візуалізація атаки стікером.
- Авто-пас для гри на двох.
- Автовидалення службових повідомлень.
- Система тем для карт.

### Changed
- Покращено текстове представлення карт.
- Проведено повну локалізацію.

### Fixed
- Виправлено логіку пасу та переходу ходу.
- Відновлено роботу інлайн-кнопок.
