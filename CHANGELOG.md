# Історія змін

## [1.2.41] - 2024-06-10

### Fixed
- **Виправлено фундаментальну логіку порівняння карт:** Усунуто критичну помилку, через яку старші карти (Дама, 10) не могли побити молодші (8, 9) тієї ж масті. Проблема полягала в тому, що ранги карт порівнювалися як рядки, а не як числа (наприклад, '12' < '8'). Логіку в методі `can_beat` було змінено для явного перетворення рангів у числа перед порівнянням, що повністю відновлює коректну ігрову механіку.

## [1.2.40] - 2024-06-10

### Fixed
- **Критична помилка `AttributeError` в інлайн-режимі:** Виправлено фундаментальну помилку, яка призводила до падіння бота при виборі карт. Обробники інлайн-запитів (`chosing.py` та `process_chosen.py`) не могли ідентифікувати гравця, що викликало `AttributeError`. Це було вирішено шляхом додавання локальної функції пошуку гравця, що відновило роботу інлайн-меню.
- **Неможливість розпочати гру творцем:** Усунуто помилку в конструкторі класу `Game`, через яку творець гри не додавався до списку гравців. Це виправлення дозволяє коректно створювати та розпочинати ігри.

## [1.2.39] - 2024-06-09

### Fixed
- **Усунено "застрягання" гравців:** Вирішено критичну помилку, через яку гравці не могли приєднатися до нової гри після перезавантаження бота. Статус гравця (`is_playing`) тепер надійно зберігається у базі даних, а не в тимчасовій пам'яті.

### Refactor
- **Централізація керування станом:** Логіка перевірки та оновлення статусу гравця повністю перенесена до `GameManager`. Це усуває дублювання коду та робить `GameManager` єдиним джерелом правди про стан гравця.
- **Видалення застарілої логіки:** Повністю видалено ненадійні функції `player_for_user` та `check_user_ex_in_all_games`. Усі обробники команд (`/leave`, `/goleave`, `/kick` та ін.) тепер використовують нові методи `GameManager`.

## [1.2.38] - 2024-06-08

### Changed
- **Уніфіковано ігрові кнопки:** Забезпечено однаковий досвід користувача, використовуючи єдину інлайн-клавіатуру (`CHOISE`) під усіма ключовими повідомленнями, що керують ходом гри: "Початок раунду", "Перехід ходу" та "Хід залишається". Це усунуло непослідовність і спростило логіку в `durak/handlers/game/process_chosen.py` шляхом видалення старого повідомлення та надсилання нового з уніфікованою кнопкою.

## [1.2.37] - 2024-06-07

### Fixed
- **Критична помилка `ModuleNotFoundError`:** Виправлено помилку `ModuleNotFoundError: No module named 'durak.logic.exceptions'`, яка виникала при запуску бота. Помилка була спричинена неправильним імпортом `NoGameInChatError` у файлі `durak/handlers/game/`

## [1.2.32] - 2024-06-04

### Fixed
- **Повністю перероблено логіку завершення раунду ("бито"):** Усунуто фундаментальну помилку, яка призводила до "зависання" гри та псувала ігровий досвід через непотрібні дії.
    - **Відмова від "колективного бито":** Повністю видалено хибну логіку, яка вимагала пасу від усіх гравців, що могли підкинути. Тепер раунд завершується **виключно** за рішенням **головного атакуючого** або якщо він не може більше підкинути.
    - **Спрощення ігрового циклу:** Перероблено функції `do_pass`, `do_attack_card` та `do_defence_card` в `durak/logic/actions.py` для реалізації цієї спрощеної моделі. Це усуває потребу в кнопці "Бито" і робить перехід ходу автоматичним та миттєвим.
    - **Відновлення стабільної моделі `Game`:** Об'єкт гри (`durak/objects/game.py`) повернуто до стабільної версії, яка використовує простий прапорець `is_pass` замість складної та помилкової системи `_temp_passed_attackers`.
